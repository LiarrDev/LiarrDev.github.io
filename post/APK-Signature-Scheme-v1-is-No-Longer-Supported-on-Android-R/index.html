<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Android R 不再支持 APK Signature Scheme v1 | Liarr&#39;s Studio</title>
<meta name="description" content="温故而知新" />
<link rel="shortcut icon" href="https://LiarrDev.github.io/favicon.ico">
<link rel="stylesheet" href="https://LiarrDev.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

<script src="https://LiarrDev.github.io/media/js/jquery.min.js"></script>
<script src="https://LiarrDev.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://LiarrDev.github.io/media/js/aos.js"></script>
<script src="https://LiarrDev.github.io/media/js/pace.min.js"></script>
<script src="https://LiarrDev.github.io/media/js/view-image.min.js"></script>
<script src="https://LiarrDev.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://LiarrDev.github.io/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="最近刚对接了一个新游戏，处理完渠道广告后，市场和运营的同事反馈说在 ViVO 手机上无法安装，系统提示如下：

既然直接下载安装会失败，那可以借助 ADB 工具安装一下，收到如下报错：
➜   adb install game.apk
  ..." />
    <meta name="keywords" content="Android" />
    <script src="https://LiarrDev.github.io/media/js/waterfall.min.js"></script>
    <script src="https://LiarrDev.github.io/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://LiarrDev.github.io"><img src="/media/images/custom-headerLogo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://LiarrDev.github.io" class="menu">首页</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      归档
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      标签
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      关于
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1760867331131" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="搜点啥..." aria-label="搜点啥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://LiarrDev.github.io/post-images/APK-Signature-Scheme-v1-is-No-Longer-Supported-on-Android-R.png');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2021-10-19"><i class="fa fa-calendar"></i><span class="lately">4 年前</span></time>
              
              <a href="https://LiarrDev.github.io/post/APK-Signature-Scheme-v1-is-No-Longer-Supported-on-Android-R/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/APK-Signature-Scheme-v1-is-No-Longer-Supported-on-Android-R/"> </span>
              </a>
              <span id="/APK-Signature-Scheme-v1-is-No-Longer-Supported-on-Android-R/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://LiarrDev.github.io/tag/Android/" class="ctag ctag-0 ctag-Android" aria-label="">Android</a>
                    
              </div>
              <h1 class="title ularge white bold">Android R 不再支持 APK Signature Scheme v1</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <p>最近刚对接了一个新游戏，处理完渠道广告后，市场和运营的同事反馈说在 ViVO 手机上无法安装，系统提示如下：</p>
<figure data-type="image" tabindex="1"><img src="https://LiarrDev.github.io/post-images/1634485633926.png" alt="安装失败截图" loading="lazy"></figure>
<p>既然直接下载安装会失败，那可以借助 ADB 工具安装一下，收到如下报错：</p>
<pre><code class="language-Shell">➜   adb install game.apk
  Performing Streamed Install
  adb: failed to install game.apk: Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES: Scanning Failed.: No signature found in package of version 2 or newer for package &lt;package_name&gt;]
</code></pre>
<p>意思是说安装包没有 V2 或更高等级的签名。</p>
<p>因为在我的华为手机上是能安装成功的，所以首先可以考虑是 Android 版本问题或 ROM 的问题。</p>
<p>由于 ROM 的独有特征比较难去追踪，因此先看看是否为 Android 版本问题，反馈的两台 ViVO 手机皆为 Android R（API 30，Android 11），而我的华为手机是 Android Q（API 29，Android 10），去官网看看 Android 11 的版本新特性：</p>
<blockquote>
<p>Apps that target Android 11 (API level 30) that are currently only signed using APK Signature Scheme v1 must now also be signed using APK Signature Scheme v2 or higher. Users can't install or update apps that are only signed with APK Signature Scheme v1 on devices that run Android 11.</p>
<p>对于以 Android 11（API 30）为目标平台，且目前仅使用 APK 签名方案 v1 签名的应用，现在还必须使用 APK 签名方案 v2 或更高版本进行签名。用户无法在搭载 Android 11 的设备上安装或更新仅通过 APK 签名方案 v1 签名的应用。</p>
</blockquote>
<p>简单来说就是，<code>targetSdkVersion</code> 为 <code>30</code> 且仅使用 V1 签名的应用无法在 Android 11 的手机上正常安装。</p>
<p>我遇到的这个问题恰好就是因为这个原因导致的，因为在对接某些渠道的时候，渠道方会要求使用 V1 签名于是我们目前全渠道都使用 V1 签名方案，而这次研发提供的游戏包又恰好 <code>targetSdkVersion</code> 是 <code>30</code>。</p>
<p>既然这个问题由两个条件产生的，那就有两个解决方法。</p>
<p>第一种解决方法是使用 V2 或更高版本的签名方案，即使用『ApkSigner』工具进行签名。</p>
<p>使用这个方法也有要注意的地方，官方文档中都有提到：</p>
<blockquote>
<p>Apps that target Android 11 (API level 30) or higher can't be installed if they contain a compressed <code>resources.arsc</code> file or if this file is not aligned on a 4-byte boundary.</p>
<p>如果以 Android 11（API 30）或更高版本为目标平台的应用包含压缩的 <code>resources.arsc</code> 文件或者如果此文件未按 4 字节边界对齐，应用将无法安装。</p>
</blockquote>
<p>即 <code>targetSdkVersion</code> 为 <code>30</code> 的应用必须对 APK 文件作对齐优化，在此之前，Android 官方一直都只是建议对齐，并未强制要求。</p>
<p>具体的操作方法在之前的『<a href="https://liarrdev.github.io/post/Getting-Started-with-Android-Decompilation/">Android 反编译入门指南</a>』一文中有详细的介绍。</p>
<p>第二种解决方法是将 <code>targetSdkVersion</code> 降为 <code>30</code> 以下。</p>
<p>将 <code>targetSdkVersion</code> 降级最好由应用的开发者来处理，在游戏行业由于游戏包往往需要经过多个公司发行联运流转，这种情况就会比较麻烦，最好交给上游处理，除非上游不予处理，下游才自行处理。</p>
<p>因为上游可以在工程项目中做调整，有什么问题也能够及时发现，下游只能对现有 APK 文件做修改，很容易出问题。</p>
<p>上游的修改就不多说了，直接在『Android Studio』中处理即可，主要介绍一下下游的处理方案。</p>
<p>依然参考『<a href="https://liarrdev.github.io/post/Getting-Started-with-Android-Decompilation/">Android 反编译入门指南</a>』一文，首先对 APK 文件使用『Apktool』进行反编译，然后在 <code>apktool.yml</code> 中修改 <code>targetSdkVersion</code>：</p>
<pre><code class="language-YAML">sdkInfo:
  minSdkVersion: '16'
  targetSdkVersion: '29'
</code></pre>
<p>修改完成后理论上就可以重新打包了，但是我重新打包后发现即使 <code>targetSdkVersion</code> 已经降为 <code>29</code> 了但依然有可能没有解决问题，还需要去 <code>AndroidManifest.xml</code> 中将相关版本信息删除掉，即将：</p>
<pre><code class="language-XML">&lt;manifest ...
    platformBuildVersionCode=&quot;1&quot;
    platformBuildVersionName=&quot;1.0&quot;
    android:compileSdkVersion=&quot;23&quot;
    android:compileSdkVersionCodename=&quot;6.0-2438415&quot;
    android:installLocation=&quot;auto&quot;&gt;
    ...
&lt;/manifest&gt;
</code></pre>
<p>修改为：</p>
<pre><code class="language-XML">&lt;manifest ...
    platformBuildVersionCode=&quot;1&quot;
    platformBuildVersionName=&quot;1.0&quot;
    android:installLocation=&quot;auto&quot;&gt;
    ...
&lt;/manifest&gt;
</code></pre>
<p>然后回编译，相关版本信息会自动补全，最后使用『JarSigner』或『ApkSigner』工具进行 V1 签名即可。</p>
<p>虽然两种方法都能解决问题，但依然建议使用第一种方案，即使用『ApkSigner』工具进行 V2 签名，毕竟降级只是一个缓兵之计，开倒车就跟不上技术发展的潮流了。</p>
<h1 id="参考内容">参考内容</h1>
<ul>
<li><a href="https://developer.android.google.cn/about/versions/11/behavior-changes-11">行为变更：以 Android 11 为目标平台的应用 | Android 开发者 | Android Developers</a></li>
</ul>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://LiarrDev.github.io/post-images/Scrcpy.png');"></div>
                 <a href="https://LiarrDev.github.io/post/Scrcpy/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2021-10-29">2021-10-29</time>
                  <h4 class="title white no-margin">Scrcpy</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://LiarrDev.github.io/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://LiarrDev.github.io/post-images/Double-Click-the-BACK-Key-to-Exit-on-Android .png');"></div>
                 <a href="https://LiarrDev.github.io/post/Double-Click-the-BACK-Key-to-Exit-on-Android /" class="full-link"></a>
                 <div class="info">
                  <time datetime="2021-10-06">2021-10-06</time>
                  <h4 class="title white no-margin">Android 实现双击 Back 键退出应用</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://LiarrDev.github.io/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                
                  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>
<div class="clear"></div>

<script>
  var gitalk = new Gitalk({
    clientID: '92c64360108d74cc926d',
    clientSecret: '4d07c0a120bd31a7b0cfd8f588c616d543448893',
    repo: 'LiarrDev.github.io',
    owner: 'LiarrDev',
    admin: ['LiarrDev'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>

                
                
              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">最新文章</h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://LiarrDev.github.io/post/How-to-Trace-Android-Dependency-Sources/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://LiarrDev.github.io/post-images/How-to-Trace-Android-Dependency-Sources.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2025-10-29">2025-10-29</time>
                      <h4 class="title usmall">
                        <a href="https://LiarrDev.github.io/post/How-to-Trace-Android-Dependency-Sources/">如何追踪 Android 依赖来源</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://LiarrDev.github.io/post/DataStore-Pull-You-Out-of-SharedPreferences-Quagmire/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://LiarrDev.github.io/post-images/DataStore-Pull-You-Out-of-SharedPreferences-Quagmire.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2025-09-17">2025-09-17</time>
                      <h4 class="title usmall">
                        <a href="https://LiarrDev.github.io/post/DataStore-Pull-You-Out-of-SharedPreferences-Quagmire/">用 DataStore 将你拉出 SharedPreferences 泥潭</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://LiarrDev.github.io/post/Protocol-Buffers-Usage-on-Android/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://LiarrDev.github.io/post-images/Protocol-Buffers-Usage-on-Android.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2025-08-25">2025-08-25</time>
                      <h4 class="title usmall">
                        <a href="https://LiarrDev.github.io/post/Protocol-Buffers-Usage-on-Android/">在 Android 中使用 Protocol Buffers</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">标签云</h4>
                  <div class="tagcloud">
                    
                      <a href="https://LiarrDev.github.io/tag/Android/" class="ctag ctag-0 ctag-Android" aria-label="">Android</a>
                    
                      <a href="https://LiarrDev.github.io/tag/3PRwtWYOei/" class="ctag ctag-1 ctag-3PRwtWYOei" aria-label="">Design Pattern</a>
                    
                      <a href="https://LiarrDev.github.io/tag/vAaPhYGe0/" class="ctag ctag-2 ctag-vAaPhYGe0" aria-label="">HarmonyOS</a>
                    
                      <a href="https://LiarrDev.github.io/tag/Server/" class="ctag ctag-3 ctag-Server" aria-label="">Server</a>
                    
                      <a href="https://LiarrDev.github.io/tag/Java/" class="ctag ctag-4 ctag-Java" aria-label="">Java</a>
                    
                      <a href="https://LiarrDev.github.io/tag/Algorithm/" class="ctag ctag-5 ctag-Algorithm" aria-label="">Algorithm</a>
                    
                      <a href="https://LiarrDev.github.io/tag/-qO3SInb4/" class="ctag ctag-6 ctag--qO3SInb4" aria-label="">Flutter</a>
                    
                      <a href="https://LiarrDev.github.io/tag/Hosts/" class="ctag ctag-7 ctag-Hosts" aria-label="">Hosts</a>
                    
                      <a href="https://LiarrDev.github.io/tag/Blog/" class="ctag ctag-8 ctag-Blog" aria-label="">Blog</a>
                    
                      <a href="https://LiarrDev.github.io/tag/JavaScript/" class="ctag ctag-9 ctag-JavaScript" aria-label="">JavaScript</a>
                    
                      <a href="https://LiarrDev.github.io/tag/LaaHFFyAa/" class="ctag ctag-10 ctag-LaaHFFyAa" aria-label="">HTML / CSS</a>
                    
                      <a href="https://LiarrDev.github.io/tag/NodeJS/" class="ctag ctag-11 ctag-NodeJS" aria-label="">Node.js</a>
                    
                      <a href="https://LiarrDev.github.io/tag/C&amp;C++/" class="ctag ctag-12 ctag-C&amp;C++" aria-label="">C / C++</a>
                    
                      <a href="https://LiarrDev.github.io/tag/React-Native/" class="ctag ctag-13 ctag-React-Native" aria-label="">React Native</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">关于我</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://LiarrDev.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Liarr&#39;s Studio</a></h4>
                    <p class="founder">温故而知新</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/LiarrDev" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://LiarrDev.github.io"><img src="/media/images/gridea.png" alt=""></a>
        </div>
        <p class="published border-effect">
          ©2020 共 147 篇文章
          <br/>
          Theme <a href="https://github.com/lmm214/gridea-theme-breek" target="_blank">「breek」</a> Powered by <a href="https://gridea.dev/" target="_blank">「Gridea」</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        

      
    <script src="https://LiarrDev.github.io/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
